<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Badge Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --gold: #A38A5B;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
            background: #fafafa;
            color: #111;
        }

        header {
            max-width: 980px;
            margin: 24px auto 12px;
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
        }

        header a {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            color: #111;
            text-decoration: none;
        }

        main {
            max-width: 980px;
            margin: 0 auto 48px;
        }

        form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        label {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .actions {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 4px
        }

        .btn-primary {
            padding: 10px 14px;
            border: 1px solid #111;
            border-radius: 6px;
            background: #111;
            color: #fff;
            cursor: pointer
        }

        .btn {
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            color: #111;
            text-decoration: none
        }

        .grid {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start
        }

        textarea {
            width: 100%;
            height: 320px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: ui-monospace, Menlo, Consolas, monospace
        }

        canvas {
            width: 320px;
            height: 320px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            background: #fff
        }
    </style>
</head>

<body>
    <header>
        <h1 style="font-size:18px;margin:0">Badge Generator</h1>
        <nav>
            <a href="/">← Back to Home</a>
        </nav>
    </header>

    <main>
        <form id="badge-form">
            <label>
                <span>Student name</span>
                <input id="bf-name" type="text" placeholder="Jane Doe" required />
            </label>
            <label>
                <span>Course</span>
                <input id="bf-course" type="text" placeholder="Intro to Hydration" required />
            </label>
            <label>
                <span>Module</span>
                <input id="bf-module" type="text" placeholder="Module 1: Basics" required />
            </label>
            <label>
                <span>Date (optional)</span>
                <input id="bf-date" type="date" />
            </label>
            <label style="grid-column:1/-1">
                <span>Background image URL (optional)</span>
                <input id="bf-bg" type="url" placeholder="https://.../background.png" />
            </label>
            <div class="actions">
                <button id="bf-generate" type="submit" class="btn-primary">Generate Badge</button>
                <a id="bf-download" download="badge.png" class="btn" style="display:none">Download PNG</a>
            </div>
        </form>

        <div class="grid">
            <div>
                <h3 style="margin:6px 0 10px;">Preview</h3>
                <canvas id="badge-canvas" width="800" height="800"></canvas>
            </div>
            <div>
                <h3 style="margin:6px 0 10px;">SVG (for designers)</h3>
                <textarea id="badge-svg-out" readonly></textarea>
            </div>
        </div>
    </main>

    <script>
        const form = document.getElementById('badge-form');
        const outSvg = document.getElementById('badge-svg-out');
        const canvas = document.getElementById('badge-canvas');
        const ctx = canvas.getContext('2d');
        const dl = document.getElementById('bf-download');

        function makeBadgeSVG({ name, course, module, date, bgUrl }) {
            const issued = date || new Date().toISOString().slice(0, 10);
            const esc = (s) => String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            const title = `${esc(module)} — ${esc(course)}`;
            return `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="800" height="800" viewBox="0 0 800 800">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#111"/>
      <stop offset="100%" stop-color="#444"/>
    </linearGradient>
    <clipPath id="rounded"><rect x="0" y="0" width="800" height="800" rx="36" ry="36"/></clipPath>
  </defs>
  <g clip-path="url(#rounded)">
    <rect width="800" height="800" fill="url(#g)"/>
    ${bgUrl ? `<image href="${esc(bgUrl)}" x="0" y="0" width="800" height="800" preserveAspectRatio="xMidYMid slice" opacity="0.25"/>` : ''}
    <circle cx="400" cy="280" r="120" fill="#A38A5B"/>
    <text x="400" y="290" text-anchor="middle" fill="#fff" font-family="Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto" font-size="120" font-weight="700">★</text>
    <text x="400" y="450" text-anchor="middle" fill="#fff" font-family="Inter, ui-sans-serif, system-ui" font-size="30" opacity=".95">${title}</text>
    <text x="400" y="500" text-anchor="middle" fill="#fff" font-family="Inter, ui-sans-serif, system-ui" font-size="22" opacity=".9">Awarded to</text>
    <text x="400" y="540" text-anchor="middle" fill="#fff" font-family="Inter, ui-sans-serif, system-ui" font-size="32" font-weight="700">${esc(name)}</text>
    <text x="400" y="585" text-anchor="middle" fill="#fff" font-family="Inter, ui-sans-serif, system-ui" font-size="18" opacity=".8">Issued: ${esc(issued)}</text>
  </g>
</svg>`;
        }

        async function svgToPng(svgText) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const svgBlob = new Blob([svgText], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(svgBlob);
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    URL.revokeObjectURL(url);
                    canvas.toBlob((blob) => {
                        const dlUrl = URL.createObjectURL(blob);
                        dl.href = dlUrl;
                        dl.style.display = 'inline-block';
                        resolve();
                    }, 'image/png');
                };
                img.onerror = reject;
                img.src = url;
            });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('bf-name').value.trim();
            const course = document.getElementById('bf-course').value.trim();
            const module = document.getElementById('bf-module').value.trim();
            const date = document.getElementById('bf-date').value;
            const bgUrl = document.getElementById('bf-bg').value.trim();
            const svg = makeBadgeSVG({ name, course, module, date, bgUrl });
            outSvg.value = svg;
            await svgToPng(svg);
        });
    </script>
</body>

</html>