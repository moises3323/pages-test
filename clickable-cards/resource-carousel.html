<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recursos Carousel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --card-width: 300px;
        --card-height: 420px;
        --step-x: 170px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Manrope", "Segoe UI", sans-serif;
        color: #1f2b3a;
        background:
          radial-gradient(circle at 15% 20%, rgba(255, 255, 255, 0.95), rgba(247, 248, 251, 0.94) 45%, rgba(240, 242, 246, 0.97) 100%),
          repeating-linear-gradient(130deg, rgba(16, 24, 40, 0.05) 0 1px, transparent 1px 10px);
      }

      .page {
        width: min(1160px, 100%);
        margin: 0 auto;
        padding: 56px 16px 32px;
      }

      .title {
        margin: 0;
        text-align: center;
        font-size: clamp(2rem, 3vw, 3.25rem);
        font-weight: 800;
        letter-spacing: -0.02em;
      }

      .subtitle {
        margin: 10px 0 0;
        text-align: center;
        font-size: clamp(1rem, 1.8vw, 1.45rem);
        color: #5a6472;
      }

      .carousel-wrap {
        position: relative;
        margin-top: 34px;
        padding: 10px 0 18px;
        overflow: hidden;
        touch-action: pan-y;
      }

      .carousel {
        position: relative;
        height: calc(var(--card-height) + 36px);
      }

      .resource-card {
        position: absolute;
        left: 50%;
        top: 0;
        width: var(--card-width);
        height: var(--card-height);
        cursor: pointer;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.27);
        transition:
          transform 460ms cubic-bezier(0.22, 1, 0.36, 1),
          opacity 360ms ease,
          filter 360ms ease,
          box-shadow 360ms ease;
        transform-origin: center center;
        background: #0f172a;
      }

      .resource-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .resource-card.is-active {
        box-shadow: 0 26px 56px rgba(15, 23, 42, 0.36);
      }

      @media (max-width: 860px) {
        :root {
          --card-width: 252px;
          --card-height: 360px;
          --step-x: 118px;
        }
      }

      @media (max-width: 560px) {
        :root {
          --card-width: 216px;
          --card-height: 316px;
          --step-x: 88px;
        }

        .page {
          padding-top: 34px;
        }

        .carousel-wrap {
          margin-top: 20px;
        }

      }

      @media (prefers-reduced-motion: reduce) {
        .resource-card {
          transition: none;
        }
      }
    </style>
  </head>
  <body>
    <main class="page">
      <h1 class="title">Lorem ipsum</h1>
      <p class="subtitle">Lorem ipsum dolor sit amet.</p>

      <section class="carousel-wrap" aria-label="Lorem ipsum">
        <div class="carousel" id="carousel"></div>
      </section>
    </main>

    <script id="carousel-data" type="application/json">
      {
        "title": "Lorem ipsum",
        "subtitle": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
        "cards": [
          {
            "title": "Lorem ipsum dolor sit amet",
            "image": "../imgs/jpg/team_pixel.jpg",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum consectetur adipiscing",
            "image": "../imgs/png/ninos.png",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum sed do eiusmod",
            "image": "../imgs/png/office_day.png",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum tempor incididunt",
            "image": "../imgs/jpg/ru_pixel.jpg",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum ut labore dolore",
            "image": "../imgs/jpg/team_pixel.jpg",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum magna aliqua",
            "image": "../imgs/png/ninos.png",
            "alt": "Lorem ipsum"
          },
          {
            "title": "Lorem ipsum enim ad minim",
            "image": "../imgs/png/office_day.png",
            "alt": "Lorem ipsum"
          }
        ]
      }
    </script>

    <script>
      (function () {
        const carousel = document.getElementById("carousel");
        const dataNode = document.getElementById("carousel-data");
        const titleNode = document.querySelector(".title");
        const subtitleNode = document.querySelector(".subtitle");
        const carouselWrap = document.querySelector(".carousel-wrap");

        const fallbackData = {
          title: "Lorem ipsum",
          subtitle: "Lorem ipsum dolor sit amet.",
          cards: [
            {
              title: "Lorem ipsum dolor",
              image: "../imgs/jpg/team_pixel.jpg",
              alt: "Lorem ipsum",
            },
            {
              title: "Lorem ipsum sit amet",
              image: "../imgs/png/ninos.png",
              alt: "Lorem ipsum",
            },
            {
              title: "Lorem ipsum adipiscing",
              image: "../imgs/png/office_day.png",
              alt: "Lorem ipsum",
            },
          ],
        };

        function parseCarouselData() {
          if (!dataNode) return fallbackData;
          try {
            const parsed = JSON.parse(dataNode.textContent || "{}");
            if (!Array.isArray(parsed.cards) || !parsed.cards.length) {
              return fallbackData;
            }
            return parsed;
          } catch {
            return fallbackData;
          }
        }

        function buildCards(items) {
          carousel.innerHTML = "";
          items.forEach((item) => {
            const article = document.createElement("article");
            article.className = "resource-card";

            const image = document.createElement("img");
            image.src = item.image;
            image.alt = item.alt || "Lorem ipsum";
            article.appendChild(image);
            carousel.appendChild(article);
          });
        }

        const carouselData = parseCarouselData();
        titleNode.textContent = carouselData.title || "Lorem ipsum";
        subtitleNode.textContent = carouselData.subtitle || "Lorem ipsum dolor sit amet.";
        buildCards(carouselData.cards);

        const cards = Array.from(document.querySelectorAll(".resource-card"));
        let activeIndex = 0;
        let autoplayTimer = null;
        const AUTOPLAY_MS = 2200;
        let suppressClickUntil = 0;
        let pointerDown = false;
        let pointerStartX = 0;
        let draggedInGesture = false;

        function circularOffset(index, active, total) {
          let offset = index - active;
          if (offset > total / 2) offset -= total;
          if (offset < -total / 2) offset += total;
          return offset;
        }

        function render() {
          const total = cards.length;

          cards.forEach((card, index) => {
            const offset = circularOffset(index, activeIndex, total);
            const abs = Math.abs(offset);
            const hidden = abs > 3;

            const translateX = offset * parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--step-x"));
            const translateY = abs * 18;
            const scale = 1 - abs * 0.12;
            const opacity = 1 - abs * 0.22;

            card.style.transform =
              "translate(-50%, 0) translateX(" +
              translateX +
              "px) translateY(" +
              translateY +
              "px) scale(" +
              scale +
              ")";
            card.style.opacity = hidden ? "0" : String(Math.max(opacity, 0.12));
            card.style.filter = "saturate(" + (1 - abs * 0.08) + ")";
            card.style.zIndex = String(100 - abs);
            card.style.pointerEvents = hidden ? "none" : "auto";
            card.classList.toggle("is-active", index === activeIndex);
          });
        }

        function next() {
          activeIndex = (activeIndex + 1) % cards.length;
          render();
        }

        function prev() {
          activeIndex = (activeIndex - 1 + cards.length) % cards.length;
          render();
        }

        function startAutoplay() {
          stopAutoplay();
          autoplayTimer = setInterval(next, AUTOPLAY_MS);
        }

        function stopAutoplay() {
          if (autoplayTimer) clearInterval(autoplayTimer);
          autoplayTimer = null;
        }

        function restartAutoplay() {
          startAutoplay();
        }

        cards.forEach((card, index) => {
          card.addEventListener("click", () => {
            if (Date.now() < suppressClickUntil) return;
            if (index === activeIndex) {
              next();
            } else {
              activeIndex = index;
              render();
            }
            restartAutoplay();
          });
        });

        carouselWrap.addEventListener("pointerdown", (event) => {
          pointerDown = true;
          pointerStartX = event.clientX;
          draggedInGesture = false;
          if (carouselWrap.setPointerCapture) {
            try {
              carouselWrap.setPointerCapture(event.pointerId);
            } catch {}
          }
        });

        carouselWrap.addEventListener("pointermove", (event) => {
          if (!pointerDown) return;
          const deltaX = event.clientX - pointerStartX;
          const dragStepThreshold = 48;
          if (Math.abs(deltaX) < dragStepThreshold) return;

          if (deltaX < 0) {
            next();
          } else {
            prev();
          }
          pointerStartX = event.clientX;
          draggedInGesture = true;
          suppressClickUntil = Date.now() + 260;
          restartAutoplay();
        });

        carouselWrap.addEventListener("pointerup", (event) => {
          if (!pointerDown) return;
          pointerDown = false;
          if (draggedInGesture) {
            suppressClickUntil = Date.now() + 260;
          }

          if (carouselWrap.releasePointerCapture) {
            try {
              carouselWrap.releasePointerCapture(event.pointerId);
            } catch {}
          }
        });

        carouselWrap.addEventListener("pointercancel", () => {
          pointerDown = false;
          draggedInGesture = false;
        });

        window.addEventListener("keydown", (event) => {
          if (event.key === "ArrowRight") {
            next();
            restartAutoplay();
          }
          if (event.key === "ArrowLeft") {
            prev();
            restartAutoplay();
          }
        });

        render();
        startAutoplay();
      })();
    </script>
  </body>
</html>
